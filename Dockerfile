FROM debian:bullseye-slim

ENV LC_CTYPE C.UTF-8
RUN adduser --disabled-password --gecos '' pwn
RUN apt update && apt upgrade -y && apt install man manpages-dev less libglib2.0-dev elfutils libc6-dbg vim tmux nasm gdb gcc-multilib clang make cmake g++-multilib binutils bsdmainutils tmuxp file p7zip unzip procps python3 python3-pip python3-setuptools git libssl-dev python3-dev libffi-dev build-essential ruby ruby-dev socat wget curl netcat python3-ipython ltrace strace -y --no-install-recommends && gem install one_gadget seccomp-tools && python3 -m pip install --upgrade pip wheel && wget https://github.com/Arinerron/heaptrace/releases/download/2.2.8/heaptrace_2.2.8.2-0_x86_64.deb -O /tmp/heaptrace.deb && dpkg -i /tmp/heaptrace.deb && apt install -f -y && rm -rf /var/lib/apt/list/*

USER pwn
ENV PATH "$PATH:/home/pwn/.local/bin"
WORKDIR /home/pwn
RUN python3 -m pip install keystone-engine capstone ropper pwntools checksec.py angr lief unicorn decomp2dbg && decomp2dbg --install && mkdir /home/pwn/.tools && wget 'https://github.com/io12/pwninit/releases/download/3.2.0/pwninit' -O /home/pwn/.local/bin/pwninit && chmod +x /home/pwn/.local/bin/pwninit  && cd /home/pwn/.tools && git clone https://github.com/pwndbg/pwndbg && cd pwndbg && pip install -r requirements.txt && echo "source $PWD/gdbinit.py" >> /home/pwn/.gdbinit && echo "set history save on" >> /home/pwn/.gdbinit && cd /home/pwn/.tools && git clone https://github.com/zardus/preeny.git && cd /home/pwn/.tools && git clone https://github.com/jacereda/fsatrace.git
RUN echo 'set tabstop=4\nset shiftwidth=4\nset softtabstop=0\nset noexpandtab\nset smarttab\nset paste\nset incsearch\nset hlsearch\nset ignorecase\nset autoindent\nset wildmenu\nsyntax on' > /home/pwn/.vimrc
RUN echo "set -g status-interval 1\nset -g status-justify left \nset -g status-left '#[fg=green] #H '##[default]'\nset-option -g status-right ''\nset -g status-fg white\nset -g status-bg default\nset -g status-attr default\nset-window-option -g window-status-fg white\nset-window-option -g window-status-bg default\nset-window-option -g window-status-attr dim\nset-window-option -g window-status-current-fg white\nset-window-option -g window-status-current-bg default\nset-window-option -g window-status-current-attr bright\nset -g message-fg white\nset -g message-bg black\nset -g message-attr bright\nset -g default-terminal 'screen-256color'" > /home/pwn/.tmux.conf

WORKDIR /home/pwn/target
